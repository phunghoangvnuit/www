<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>YouTube → Embed iframe</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 32px; }
    .card { max-width: 880px; margin: 0 auto; padding: 20px; border: 1px solid #e5e7eb; border-radius: 16px; box-shadow: 0 6px 24px rgba(0,0,0,.06); }
    label { font-weight: 600; display: block; margin-bottom: 8px; }
    input[type="url"] { width: 100%; padding: 12px 14px; border: 1px solid #d1d5db; border-radius: 12px; font-size: 16px; }
    .row { display: flex; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
    button { padding: 10px 14px; border: 0; border-radius: 10px; background: #111827; color: white; cursor: pointer; font-weight: 600; }
    button.secondary { background: #374151; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .out { margin-top: 16px; display: grid; gap: 8px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: #f9fafb; border: 1px solid #e5e7eb; padding: 10px 12px; border-radius: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    iframe { width: 100%; aspect-ratio: 16 / 9; border: 0; border-radius: 12px; }
    small.hint { color: #6b7280; }
  </style>
</head>
<body>
  <div class="card">
    <h1>YouTube URL → Embed iframe</h1>
    <p class="hint">
      Paste a YouTube link (e.g. <span class="mono">https://youtu.be/dQw4w9WgXcQ?t=43</span>) and I’ll generate an embed and insert the <code>&lt;iframe&gt;</code>.
    </p>

    <label for="yt-url">YouTube video URL</label>
    <input id="yt-url" type="url" placeholder="https://www.youtube.com/watch?v=VIDEO_ID&t=1m30s" />

    <div class="row">
      <button id="convert">Generate & Embed</button>
      <button id="clear" class="secondary">Clear</button>
    </div>

    <div class="out">
      <div>
        <label>Embed URL</label>
        <div class="row">
          <div id="embed-url" class="mono" title=""></div>
          <button id="copy" class="secondary" disabled>Copy</button>
        </div>
        <small class="hint">You can use this URL wherever an embed link is needed.</small>
      </div>

      <div id="player-wrap"></div>
    </div>
  </div>

  <script>
    const urlInput   = document.getElementById('yt-url');
    const convertBtn = document.getElementById('convert');
    const clearBtn   = document.getElementById('clear');
    const copyBtn    = document.getElementById('copy');
    const out        = document.getElementById('embed-url');
    const playerWrap = document.getElementById('player-wrap');

    function parseTimeToSeconds(raw) {
      // Accepts "90", "90s", "1m30s", "2h1m", "1h02m03s"
      if (!raw) return 0;
      if (/^\d+$/.test(raw)) return parseInt(raw, 10);
      let s = 0, m = 0, h = 0;
      const hMatch = raw.match(/(\d+)\s*h/);
      const mMatch = raw.match(/(\d+)\s*m/);
      const sMatch = raw.match(/(\d+)\s*s/);
      if (hMatch) h = parseInt(hMatch[1], 10);
      if (mMatch) m = parseInt(mMatch[1], 10);
      if (sMatch) s = parseInt(sMatch[1], 10);
      if (!hMatch && !mMatch && !sMatch) {
        // If someone passes "90s" or "90" already handled above;
        // here try raw->int best-effort
        const n = parseInt(raw, 10);
        return Number.isFinite(n) ? n : 0;
      }
      return h * 3600 + m * 60 + s;
    }

    function extractVideoIdAndStart(u) {
      // Handles: watch?v=ID, youtu.be/ID, shorts/ID, embed/ID
      // Also extracts start time from t or start.
      try {
        const url = new URL(u);
        const host = url.hostname.replace(/^www\./, '');

        // Get timestamp (t or start)
        let startSec = 0;
        const t = url.searchParams.get('t');
        const start = url.searchParams.get('start');
        if (t) startSec = parseTimeToSeconds(t);
        else if (start) startSec = parseInt(start, 10) || 0;

        let id = null;

        // youtu.be/<id>
        if (host === 'youtu.be') {
          id = url.pathname.split('/')[1] || null;
        }

        // youtube.com/watch?v=<id> or other variants
        if (!id && (host.endsWith('youtube.com'))) {
          const path = url.pathname;
          if (path === '/watch') {
            id = url.searchParams.get('v');
          } else if (path.startsWith('/shorts/')) {
            id = path.split('/')[2] || null;
          } else if (path.startsWith('/embed/')) {
            id = path.split('/')[2] || null;
          }
        }

        // Validate ID (11 chars typical)
        const valid = id && /^[a-zA-Z0-9_-]{11}$/.test(id) ? id : null;
        return { id: valid, start: Math.max(0, startSec) };
      } catch (e) {
        return { id: null, start: 0 };
      }
    }

    function buildEmbedUrl(id, start = 0) {
      const base = `https://www.youtube.com/embed/${id}`;
      const params = new URLSearchParams();
      if (start) params.set('start', String(start));
      // Nice defaults:
      params.set('rel', '0');
      params.set('modestbranding', '1');
      params.set('playsinline', '1');
      return params.toString() ? `${base}?${params}` : base;
    }

    function showEmbed(url) {
      // Update text output
      out.textContent = url;
      out.title = url;

      // Remove old player
      playerWrap.innerHTML = '';

      // Create iframe via DOM manipulation
      const iframe = document.createElement('iframe');
      iframe.src = url;
      iframe.allow =
        'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
      iframe.allowFullscreen = true;

      playerWrap.appendChild(iframe);

      // Enable copy
      copyBtn.disabled = false;
    }

    convertBtn.addEventListener('click', () => {
      const raw = (urlInput.value || '').trim();
      if (!raw) {
        alert('Please paste a YouTube URL first.');
        return;
      }
      const { id, start } = extractVideoIdAndStart(raw);
      if (!id) {
        alert('Could not find a valid YouTube video ID in that URL.');
        return;
      }
      const embed = buildEmbedUrl(id, start);
      showEmbed(embed);
    });

    copyBtn.addEventListener('click', async () => {
      const text = out.textContent || '';
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = 'Copied!';
        setTimeout(() => (copyBtn.textContent = 'Copy'), 1000);
      } catch {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        ta.remove();
        copyBtn.textContent = 'Copied!';
        setTimeout(() => (copyBtn.textContent = 'Copy'), 1000);
      }
    });

    clearBtn.addEventListener('click', () => {
      urlInput.value = '';
      out.textContent = '';
      out.title = '';
      playerWrap.innerHTML = '';
      copyBtn.disabled = true;
    });

    // Convenience: auto-generate on paste+Enter
    urlInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') convertBtn.click();
    });
  </script>
</body>
</html>
